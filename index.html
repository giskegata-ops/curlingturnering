<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cu√òrLing Turnering</title>

<style>

:root {
  --primary:#1e3a8a;
  --accent:#2563eb;
  --bg:#f3f4f6;
  --card:#ffffff;
  --green:#16a34a;
  --silver:#e5e7eb;
  --bronze:#fcd34d;
}

body {
  margin:0;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:var(--bg);
}

header {
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:white;
  padding:22px;
  text-align:center;
  font-size:22px;
  font-weight:600;
  letter-spacing:0.5px;
}

.container {
  max-width:1000px;
  margin:auto;
  padding:20px;
}

.card {
  background:var(--card);
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 6px 16px rgba(0,0,0,0.08);
}

.card h3 {
  margin-top:0;
  margin-bottom:15px;
  font-size:18px;
}

.nextMatch {
  font-size:20px;
  font-weight:600;
  text-align:center;
  padding:10px;
}

.badge {
  display:inline-block;
  padding:4px 8px;
  border-radius:8px;
  font-size:12px;
  font-weight:600;
  margin-left:8px;
}

.badge1 { background:#dbeafe; color:#1e40af; }
.badge2 { background:#ede9fe; color:#5b21b6; }

table {
  width:100%;
  border-collapse:collapse;
}

th {
  background:var(--primary);
  color:white;
  padding:10px;
  font-weight:500;
}

td {
  padding:8px;
  text-align:center;
  font-size:14px;
}

tr:nth-child(even){
  background:#f9fafb;
}

.top1 { background:#fef9c3; }
.top2 { background:#f3f4f6; }
.top3 { background:#fde68a; }
.top4 { background:#dcfce7; }

.match {
  padding:10px;
  border-bottom:1px solid #eee;
  font-size:14px;
}

.match.finished {
  opacity:0.6;
}

input {
  width:45px;
  padding:4px;
  margin:0 3px;
}

button {
  padding:5px 8px;
  border:none;
  border-radius:6px;
  background:var(--primary);
  color:white;
  cursor:pointer;
  font-size:12px;
}

select {
  padding:4px;
  margin-left:5px;
  font-size:12px;
}

@media(max-width:700px){
  .nextMatch { font-size:16px; }
  th,td { font-size:12px; }
}

</style>
</head>

<body>

<header>üèÜ Cu√òrLing Turnering</header>

<div class="container">

<div class="card">
<h3>Neste kamp</h3>
<div id="nextCourt1" class="nextMatch">
Bane 1 <span class="badge badge1">1</span><br>
Ingen kamp
</div>
<hr>
<div id="nextCourt2" class="nextMatch">
Bane 2 <span class="badge badge2">2</span><br>
Ingen kamp
</div>
</div>

<div class="card">
<h3>Tabell</h3>
<table>
<thead>
<tr>
<th>#</th>
<th>Lag</th>
<th>K</th>
<th>V</th>
<th>V(ET)</th>
<th>T(ET)</th>
<th>T</th>
<th>P</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
<p style="margin-top:10px;"><b>Topp 4 g√•r til sluttspill</b></p>
</div>

<div class="card">
<h3>Alle kamper</h3>
<div id="matchList"></div>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, getDocs, updateDoc, doc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBqUL0dGsQKwLyVkayGfcI486fiAjdXcCA",
  authDomain: "curlingturnering.firebaseapp.com",
  projectId: "curlingturnering",
  storageBucket: "curlingturnering.firebasestorage.app",
  messagingSenderId: "841721815539",
  appId: "1:841721815539:web:e2734644cc50292a6af286"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function hentKamper(){

  const snapshot = await getDocs(collection(db,"matches"));
  let matches=[];

  snapshot.forEach(docSnap=>{
    matches.push({id:docSnap.id,...docSnap.data()});
  });

  matches.sort((a,b)=>a.round-b.round);

  const list=document.getElementById("matchList");
  list.innerHTML="";

  let nr=1;

  for(let m of matches){

    const div=document.createElement("div");
    div.className="match"+(m.played?" finished":"");

    if(m.played){
      div.innerHTML=
      `<b>Kamp ${nr}</b> ‚Äì Bane ${m.court}<br>
       ${m.team1Name} ${m.score1} - ${m.score2} ${m.team2Name}
       ${m.resultType==="overtime"?"(ET)":""}`;
    } else {
      div.innerHTML=
      `<b>Kamp ${nr}</b> ‚Äì Bane ${m.court}<br>
       ${m.team1Name}
       <input id="s1-${m.id}" type="number">
       -
       <input id="s2-${m.id}" type="number">
       ${m.team2Name}
       <select id="type-${m.id}">
         <option value="normal">Ordin√¶r</option>
         <option value="overtime">Ekstraomganger</option>
       </select>
       <button onclick="registrer('${m.id}')">Lagre</button>`;
    }

    list.appendChild(div);
    nr++;
  }

  oppdaterNeste(matches);
  oppdaterTabell(matches);
}

window.registrer = async function(id){

  let s1=parseInt(document.getElementById(`s1-${id}`).value)||0;
  let s2=parseInt(document.getElementById(`s2-${id}`).value)||0;
  const type=document.getElementById(`type-${id}`).value;

  if(s1===s2){ alert("M√• v√¶re vinner"); return; }

  await updateDoc(doc(db,"matches",id),{
    score1:s1,
    score2:s2,
    played:true,
    resultType:type
  });

  hentKamper();
}

function oppdaterNeste(matches){

  const next1=matches.find(m=>!m.played && m.court===1);
  const next2=matches.find(m=>!m.played && m.court===2);

  document.getElementById("nextCourt1").innerHTML=
    `Bane 1 <span class="badge badge1">1</span><br>`+
    (next1?`${next1.team1Name} vs ${next1.team2Name}`:"Ingen kamp");

  document.getElementById("nextCourt2").innerHTML=
    `Bane 2 <span class="badge badge2">2</span><br>`+
    (next2?`${next2.team1Name} vs ${next2.team2Name}`:"Ingen kamp");
}

function oppdaterTabell(matches){

  let stats={};

  matches.forEach(m=>{

    if(!stats[m.team1Name]) stats[m.team1Name]={K:0,V:0,VET:0,TET:0,T:0,P:0};
    if(!stats[m.team2Name]) stats[m.team2Name]={K:0,V:0,VET:0,TET:0,T:0,P:0};

    if(!m.played) return;

    stats[m.team1Name].K++;
    stats[m.team2Name].K++;

    if(m.score1>m.score2){
      if(m.resultType==="overtime"){
        stats[m.team1Name].VET++; stats[m.team2Name].TET++;
        stats[m.team1Name].P+=2; stats[m.team2Name].P+=1;
      } else {
        stats[m.team1Name].V++; stats[m.team1Name].P+=3;
        stats[m.team2Name].T++;
      }
    } else {
      if(m.resultType==="overtime"){
        stats[m.team2Name].VET++; stats[m.team1Name].TET++;
        stats[m.team2Name].P+=2; stats[m.team1Name].P+=1;
      } else {
        stats[m.team2Name].V++; stats[m.team2Name].P+=3;
        stats[m.team1Name].T++;
      }
    }

  });

  let arr=Object.entries(stats)
  .sort((a,b)=>b[1].P-a[1].P);

  const body=document.getElementById("tableBody");
  body.innerHTML="";

  arr.forEach((team,index)=>{
    const tr=document.createElement("tr");
    if(index===0) tr.className="top1";
    else if(index===1) tr.className="top2";
    else if(index===2) tr.className="top3";
    else if(index===3) tr.className="top4";

    tr.innerHTML=
    `<td>${index+1}</td>
     <td>${team[0]}</td>
     <td>${team[1].K}</td>
     <td>${team[1].V}</td>
     <td>${team[1].VET}</td>
     <td>${team[1].TET}</td>
     <td>${team[1].T}</td>
     <td>${team[1].P}</td>`;

    body.appendChild(tr);
  });
}

hentKamper();

</script>
</body>
</html>
